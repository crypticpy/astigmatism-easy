#!/usr/bin/env python3
"""Generate AstigmatismEasy theme variants and adaptive profiles."""

from __future__ import annotations

import copy
import json
from pathlib import Path
from typing import Dict

ROOT = Path(__file__).resolve().parents[1]
THEMES_DIR = ROOT / "themes"
BASE_THEME = THEMES_DIR / "astigmatism-easy-infrared-theme.json"


def load_theme(path: Path) -> Dict:
    with path.open("r", encoding="utf-8") as handle:
        return json.load(handle)


def save_theme(path: Path, data: Dict) -> None:
    path.parent.mkdir(parents=True, exist_ok=True)
    with path.open("w", encoding="utf-8") as handle:
        json.dump(data, handle, indent=2)
        handle.write("\n")


def remap_color(value: str, mapping: Dict[str, str]) -> str:
    if not isinstance(value, str) or not value.startswith("#"):
        return value
    hex_part = value[1:7].upper()
    alpha = value[7:]
    replacement = mapping.get(hex_part)
    if replacement:
        return f"#{replacement}{alpha}".lower()
    return value


def apply_palette(data: Dict, mapping: Dict[str, str]) -> None:
    if not mapping:
        return
    colors = data.get("colors", {})
    for key, value in list(colors.items()):
        colors[key] = remap_color(value, mapping)

    semantic_tokens = data.get("semanticTokenColors", {})
    for settings in semantic_tokens.values():
        for field in ("foreground", "background"):
            if field in settings:
                settings[field] = remap_color(settings[field], mapping)

    token_colors = data.get("tokenColors", [])
    for entry in token_colors:
        settings = entry.get("settings", {})
        for field in ("foreground", "background"):
            if field in settings:
                settings[field] = remap_color(settings[field], mapping)


VariantSpec = Dict[str, object]


VARIANTS: Dict[str, VariantSpec] = {
    "night_halation_guard": {
        "name": "AstigmatismEasy Night — Halation Guard",
        "file": "astigmatism-easy-night-theme.json",
        "colors_overrides": {
            "editor.background": "#282828",
            "editor.foreground": "#ebdbb2",
            "editorGutter.background": "#282828cc",
            "editor.selectionBackground": "#3c38365c",
            "editor.selectionHighlightBackground": "#32302f30",
            "editor.lineHighlightBackground": "#2f2c2966",
            "editor.lineHighlightBorder": "#3b322f",
            "editorCursor.foreground": "#fe8019",
            "editorWidget.background": "#32302f",
            "editorWidget.border": "#3b322f",
            "editorSuggestWidget.background": "#32302f",
            "editorHoverWidget.background": "#32302f",
            "editorHoverWidget.statusBarBackground": "#282828",
            "activityBar.background": "#32302f",
            "activityBar.activeBackground": "#3a342ccc",
            "activityBarBadge.background": "#b8bb26",
            "activityBarBadge.foreground": "#282828",
            "sideBar.background": "#32302f",
            "sideBarSectionHeader.background": "#3a342c",
            "list.activeSelectionBackground": "#3c3836",
            "list.inactiveSelectionBackground": "#34302d",
            "list.hoverBackground": "#34302d",
            "list.focusBackground": "#3e3a36cc",
            "statusBar.background": "#282828",
            "statusBar.noFolderBackground": "#32302f",
            "statusBarItem.activeBackground": "#b8bb26cc",
            "statusBarItem.hoverBackground": "#3a342ccc",
            "titleBar.activeBackground": "#282828",
            "titleBar.inactiveBackground": "#282828",
            "titleBar.border": "#2f2a27cc",
            "tab.activeBackground": "#3a342c",
            "tab.inactiveBackground": "#282828",
            "panel.background": "#2f2a27",
            "panelSectionHeader.background": "#32302f",
            "panel.border": "#3b342c",
            "terminal.background": "#1d2021",
            "terminal.border": "#32302f",
            "terminal.foreground": "#ebdbb2",
            "quickInput.background": "#32302f",
            "minimap.background": "#28282880",
            "scrollbar.shadow": "#282828cc",
            "badge.background": "#b8bb26",
            "badge.foreground": "#282828",
            "progressBar.background": "#b8bb26"
        },
        "palette": {
            "F08C7C": "fe8019",
            "F19982": "fabd2f",
            "F3A086": "d79921",
            "F3B39E": "f2d39b",
            "E7A07D": "fabd2f",
            "E08C75": "fe8019",
            "DFA480": "b8bb26",
            "E29BA8": "d3869b",
            "D66864": "fb4934",
            "E67470": "fb4934",
            "E26F6A": "fb4934",
            "E27470": "fb4934",
            "D89273": "fabd2f",
            "D69C86": "fabd2f",
            "D6655F": "fb4934",
            "C78876": "8ec07c",
            "C97F63": "b8bb26",
            "E9A8B2": "d3869b",
            "DAB3A0": "d5c4a1",
            "F6D8CC": "fbf1c7",
            "F2D6C9": "f2e5bc",
            "C6A093": "ebdbb2",
            "C18D88": "ebdbb2",
            "C9978E": "d5c4a1",
            "DE958D": "d5c4a1",
            "B17E78": "a89984",
            "B27D78": "a89984",
            "A8746E": "bdae93",
            "B6827A": "c5b79f",
            "BB6B5C": "fe8019",
            "CD7F73": "d3869b",
            "D06760": "fb4934",
            "D7786A": "fabd2f",
            "E59374": "fabd2f",
            "A26E69": "928374",
            "A06C67": "928374",
            "A87A75": "a89984",
            "996B68": "7c6f64",
            "652420": "374f2c",
            "7A2C2C": "6d3232",
            "8F4040": "7c3b3b",
            "2A1111": "3c3836",
            "2C1111": "3f3b36",
            "321212": "423c37",
            "341414": "45403b",
            "371515": "4a433e",
            "3C1616": "4f4741",
            "401818": "534b44",
            "441A1A": "585049",
            "FF7F6E": "fe8019",
            "FF9E80": "fabd2f",
            "FFB4A2": "f2d39b"
        }
    },
    "daylight_harmonics": {
        "name": "AstigmatismEasy Daylight — Harmonic Ambient",
        "file": "astigmatism-easy-day-theme.json",
        "colors_overrides": {
            "editor.background": "#2c2926",
            "editor.foreground": "#f2e5bc",
            "editorGutter.background": "#2c2926cc",
            "editor.selectionBackground": "#463f3670",
            "editor.selectionHighlightBackground": "#3a342d38",
            "editor.lineHighlightBackground": "#34302c66",
            "editor.lineHighlightBorder": "#3f3731",
            "editorCursor.foreground": "#fe8019",
            "editorWidget.background": "#34312e",
            "editorWidget.border": "#3f3731",
            "editorSuggestWidget.background": "#34312e",
            "editorHoverWidget.background": "#34312e",
            "editorHoverWidget.statusBarBackground": "#2c2926",
            "activityBar.background": "#363330",
            "activityBar.activeBackground": "#3f3830cc",
            "activityBarBadge.background": "#fabd2f",
            "activityBarBadge.foreground": "#2c2926",
            "sideBar.background": "#363330",
            "sideBarSectionHeader.background": "#3d362f",
            "list.activeSelectionBackground": "#3f3831",
            "list.inactiveSelectionBackground": "#38322c",
            "list.hoverBackground": "#38322c",
            "list.focusBackground": "#413a33cc",
            "statusBar.background": "#2c2926",
            "statusBar.noFolderBackground": "#34312e",
            "statusBarItem.activeBackground": "#ffd05ccc",
            "statusBarItem.hoverBackground": "#3f3830cc",
            "titleBar.activeBackground": "#2c2926",
            "titleBar.inactiveBackground": "#2c2926",
            "titleBar.border": "#322c26cc",
            "tab.activeBackground": "#3d362f",
            "tab.inactiveBackground": "#2c2926",
            "panel.background": "#312c27",
            "panelSectionHeader.background": "#34312e",
            "panel.border": "#3f3831",
            "terminal.background": "#23201d",
            "terminal.border": "#3a332d",
            "terminal.foreground": "#f2e5bc",
            "quickInput.background": "#34312e",
            "minimap.background": "#2c292680",
            "scrollbar.shadow": "#2c2926cc",
            "badge.background": "#fabd2f",
            "badge.foreground": "#2c2926",
            "progressBar.background": "#fabd2f"
        },
        "palette": {
            "F08C7C": "fe8019",
            "F19982": "fabd2f",
            "F3A086": "d79921",
            "F3B39E": "f2d39b",
            "E7A07D": "fabd2f",
            "E08C75": "fe8019",
            "DFA480": "b8bb26",
            "E29BA8": "d3869b",
            "D66864": "fb4934",
            "E67470": "fb4934",
            "E26F6A": "fb4934",
            "E27470": "fb4934",
            "D89273": "fabd2f",
            "D69C86": "fabd2f",
            "D6655F": "fb4934",
            "C78876": "8ec07c",
            "C97F63": "b8bb26",
            "E9A8B2": "d3869b",
            "DAB3A0": "d5c4a1",
            "F6D8CC": "fbf1c7",
            "F2D6C9": "f2e5bc",
            "C6A093": "f2e5bc",
            "C18D88": "f2e5bc",
            "C9978E": "d5c4a1",
            "DE958D": "d5c4a1",
            "B17E78": "a89984",
            "B27D78": "a89984",
            "A8746E": "bdae93",
            "B6827A": "c8b497",
            "BB6B5C": "fe8019",
            "CD7F73": "d3869b",
            "D06760": "fb4934",
            "D7786A": "fabd2f",
            "E59374": "fabd2f",
            "A26E69": "928374",
            "A06C67": "928374",
            "A87A75": "a89984",
            "996B68": "7c6f64",
            "652420": "374f2c",
            "7A2C2C": "6d3232",
            "8F4040": "7c3b3b",
            "2A1111": "3d3631",
            "2C1111": "403834",
            "321212": "463d38",
            "341414": "493f39",
            "371515": "4e433d",
            "3C1616": "534941",
            "401818": "564c44",
            "441A1A": "5b4f47",
            "FF7F6E": "fe8019",
            "FF9E80": "fabd2f",
            "FFB4A2": "f2d39b"
        }
    },
    "infrared_scotopic": {
        "name": "AstigmatismEasy Infrared — Scotopic Calm",
        "file": "astigmatism-easy-infrared-scotopic-theme.json",
        "colors_overrides": {
            "editor.background": "#150606",
            "editor.foreground": "#c39b8e",
            "editorGutter.background": "#150606cc",
            "editor.selectionBackground": "#3c151560",
            "editor.selectionHighlightBackground": "#2b0f0f32",
            "editor.lineHighlightBackground": "#1f0c0c66",
            "editor.lineHighlightBorder": "#341313",
            "editorCursor.foreground": "#de6f6b",
            "editorWidget.background": "#1b0808",
            "editorWidget.border": "#250d0d",
            "editorSuggestWidget.background": "#1b0808",
            "editorHoverWidget.background": "#1b0808",
            "editorHoverWidget.statusBarBackground": "#150606",
            "activityBar.background": "#1d0808",
            "activityBar.activeBackground": "#241010cc",
            "sideBar.background": "#1d0808",
            "sideBarSectionHeader.background": "#210c0c",
            "list.activeSelectionBackground": "#311212",
            "list.inactiveSelectionBackground": "#220d0d",
            "list.hoverBackground": "#220d0d",
            "list.focusBackground": "#341313cc",
            "statusBar.background": "#150606",
            "statusBar.noFolderBackground": "#1a0808",
            "statusBarItem.activeBackground": "#e39078cc",
            "statusBarItem.hoverBackground": "#241010cc",
            "titleBar.activeBackground": "#150606",
            "titleBar.inactiveBackground": "#150606",
            "titleBar.border": "#1d0909cc",
            "tab.activeBackground": "#210d0d",
            "tab.inactiveBackground": "#150606",
            "panel.background": "#180707",
            "panelSectionHeader.background": "#1b0808",
            "panel.border": "#240d0d",
            "terminal.background": "#100404",
            "terminal.border": "#220c0d",
            "terminal.foreground": "#d3ab99",
            "quickInput.background": "#1b0808",
            "minimap.background": "#15060680",
            "scrollbar.shadow": "#150606cc",
            "badge.background": "#e7a088",
            "progressBar.background": "#e7a088"
        },
        "palette": {
            "F08C7C": "e57d6f",
            "F19982": "e68c7c",
            "F3A086": "e2927b",
            "F3B39E": "e6a78f",
            "E7A07D": "d99472",
            "E08C75": "d27f68",
            "DFA480": "d49873",
            "E29BA8": "d792a3",
            "D66864": "c35d59",
            "E67470": "d96c66",
            "E26F6A": "cf6762",
            "E27470": "d06b66",
            "D89273": "c98167",
            "D69C86": "c38e7a",
            "D6655F": "c15a57",
            "C78876": "b87c71",
            "C97F63": "b87759",
            "E9A8B2": "d99aa6",
            "DAB3A0": "cea795",
            "F6D8CC": "ebcfc3",
            "F2D6C9": "e7c9bd",
            "C6A093": "bc9189",
            "C18D88": "b8857f",
            "C9978E": "c08d86",
            "DE958D": "d18981",
            "B17E78": "a8746f",
            "B27D78": "ab756f"
        }
    },
    "infrared_mesopic": {
        "name": "AstigmatismEasy Infrared — Mesopic Focus",
        "file": "astigmatism-easy-infrared-mesopic-theme.json",
        "colors_overrides": {
            "editor.background": "#1c0b0b",
            "editor.foreground": "#ca9f92",
            "editorGutter.background": "#1c0b0bcc",
            "editor.selectionBackground": "#44191970",
            "editor.selectionHighlightBackground": "#3412123a",
            "editor.lineHighlightBackground": "#23101066",
            "editorCursor.foreground": "#ea7f72",
            "editorWidget.background": "#210d0d",
            "editorWidget.border": "#2c1111",
            "editorSuggestWidget.background": "#210d0d",
            "editorHoverWidget.background": "#210d0d",
            "activityBar.background": "#220d0d",
            "sideBar.background": "#220d0d",
            "sideBarSectionHeader.background": "#271010",
            "list.activeSelectionBackground": "#371515",
            "list.inactiveSelectionBackground": "#2b1111",
            "list.hoverBackground": "#2b1111",
            "statusBar.background": "#1c0b0b",
            "statusBar.noFolderBackground": "#200d0d",
            "statusBarItem.activeBackground": "#ef9a80cc",
            "titleBar.activeBackground": "#1c0b0b",
            "tab.activeBackground": "#271111",
            "tab.inactiveBackground": "#1c0b0b",
            "panel.background": "#1f0d0d",
            "terminal.background": "#150707",
            "terminal.border": "#2a1111",
            "terminal.foreground": "#deb8a3",
            "quickInput.background": "#210d0d",
            "minimap.background": "#1c0b0b80",
            "scrollbar.shadow": "#1c0b0bcc",
            "badge.background": "#f1af96",
            "progressBar.background": "#f1af96"
        }
    },
    "infrared_photopic": {
        "name": "AstigmatismEasy Infrared — Photopic Clarity",
        "file": "astigmatism-easy-infrared-photopic-theme.json",
        "colors_overrides": {
            "editor.background": "#221010",
            "editor.foreground": "#d5b0a2",
            "editorGutter.background": "#221010cc",
            "editor.selectionBackground": "#4a1d1d7a",
            "editor.selectionHighlightBackground": "#38141440",
            "editor.lineHighlightBackground": "#2a141466",
            "editor.lineHighlightBorder": "#401818",
            "editorCursor.foreground": "#f28c7d",
            "editorWidget.background": "#271212",
            "editorWidget.border": "#331616",
            "editorSuggestWidget.background": "#271212",
            "editorHoverWidget.background": "#271212",
            "activityBar.background": "#2a1414",
            "sideBar.background": "#2a1414",
            "sideBarSectionHeader.background": "#301717",
            "list.activeSelectionBackground": "#3d1818",
            "list.inactiveSelectionBackground": "#321515",
            "list.hoverBackground": "#321515",
            "statusBar.background": "#221010",
            "statusBar.noFolderBackground": "#271212",
            "statusBarItem.activeBackground": "#f6b49bcc",
            "titleBar.activeBackground": "#221010",
            "titleBar.inactiveBackground": "#221010",
            "tab.activeBackground": "#301515",
            "tab.inactiveBackground": "#221010",
            "panel.background": "#251313",
            "terminal.background": "#1a0909",
            "terminal.border": "#311515",
            "terminal.foreground": "#e6c0ae",
            "quickInput.background": "#271212",
            "minimap.background": "#22101080",
            "scrollbar.shadow": "#221010cc",
            "badge.background": "#f9c2a8",
            "progressBar.background": "#f9c2a8"
        },
        "palette": {
            "F08C7C": "f39a88",
            "F19982": "f5a38f",
            "F3A086": "f7b199",
            "F3B39E": "f9c1a6",
            "E7A07D": "f0b18f",
            "E08C75": "e99e83",
            "DFA480": "f0b38c",
            "E29BA8": "f3b0b4",
            "D66864": "e37672",
            "E67470": "f0847c",
            "E26F6A": "ea7d76",
            "E27470": "ee877f",
            "D89273": "e69c7e",
            "D69C86": "e2aa91",
            "D6655F": "df726c",
            "C78876": "d39589",
            "C97F63": "d79072",
            "E9A8B2": "f4bac2",
            "DAB3A0": "ecc1ad",
            "F6D8CC": "f9e2d7",
            "F2D6C9": "f6dfd2",
            "C6A093": "d6ae9f",
            "C18D88": "d09b93",
            "C9978E": "d7a79f",
            "DE958D": "e8a79f",
            "B17E78": "bf8e86",
            "B27D78": "c08f87"
        }
    },
    "purkinje_violet": {
        "name": "AstigmatismEasy Purkinje Violet — Twilight Contrast",
        "file": "astigmatism-easy-purkinje-violet-theme.json",
        "colors_overrides": {
            "editor.background": "#160a1b",
            "editor.foreground": "#d9ccee",
            "editorGutter.background": "#160a1bcc",
            "editor.selectionBackground": "#32174466",
            "editor.selectionHighlightBackground": "#2a153c38",
            "editor.lineHighlightBackground": "#21133866",
            "editor.lineHighlightBorder": "#2f1947",
            "editorCursor.foreground": "#c48af5",
            "editorWidget.background": "#1c1025",
            "editorWidget.border": "#251534",
            "editorSuggestWidget.background": "#1c1025",
            "editorHoverWidget.background": "#1c1025",
            "editorHoverWidget.statusBarBackground": "#160a1b",
            "activityBar.background": "#1d1128",
            "activityBar.activeBackground": "#27193ecc",
            "activityBarBadge.background": "#d7a2ff",
            "activityBarBadge.foreground": "#160a1b",
            "sideBar.background": "#1d1128",
            "sideBarSectionHeader.background": "#221637",
            "list.activeSelectionBackground": "#2d173f",
            "list.inactiveSelectionBackground": "#241235",
            "list.hoverBackground": "#241235",
            "list.focusBackground": "#341b46cc",
            "statusBar.background": "#160a1b",
            "statusBar.noFolderBackground": "#1a0f24",
            "statusBarItem.activeBackground": "#dba5ffcc",
            "statusBarItem.hoverBackground": "#241235cc",
            "titleBar.activeBackground": "#160a1b",
            "titleBar.inactiveBackground": "#160a1b",
            "titleBar.border": "#1d0d29cc",
            "tab.activeBackground": "#251437",
            "tab.inactiveBackground": "#160a1b",
            "panel.background": "#1a0d26",
            "panelSectionHeader.background": "#1c1025",
            "panel.border": "#241433",
            "terminal.background": "#100516",
            "terminal.border": "#231337",
            "terminal.foreground": "#dcd0f6",
            "quickInput.background": "#1c1025",
            "minimap.background": "#160a1b80",
            "scrollbar.shadow": "#160a1bcc",
            "badge.background": "#d9a8ff",
            "progressBar.background": "#d9a8ff"
        },
        "palette": {
            "F08C7C": "c986ff",
            "F19982": "d39bff",
            "F3A086": "dba8ff",
            "F3B39E": "e5c0ff",
            "E7A07D": "cea7ff",
            "E08C75": "c493ff",
            "DFA480": "d5b1ff",
            "E29BA8": "dcb2ff",
            "D66864": "b76bf0",
            "E67470": "c375ff",
            "E26F6A": "bd6cf5",
            "E27470": "c076fb",
            "D89273": "c887f6",
            "D69C86": "cb9af8",
            "D6655F": "b362ea",
            "C78876": "b88ce3",
            "C97F63": "ba80e6",
            "E9A8B2": "e3b8ff",
            "DAB3A0": "d4b6f9",
            "F6D8CC": "efe4ff",
            "F2D6C9": "eadffd",
            "C6A093": "cebce8",
            "C18D88": "c7a7dd",
            "C9978E": "d2b6e6",
            "DE958D": "dba3ec",
            "B17E78": "b295d4",
            "B27D78": "b79bd8",
            "A8746E": "a781c5",
            "B6827A": "bea0d6",
            "BB6B5C": "9a77c8",
            "CD7F73": "a879cd",
            "D06760": "ab6fd6",
            "D7786A": "b377de",
            "E59374": "c88ae4",
            "A26E69": "9f7ec4",
            "A06C67": "9979bd",
            "A87A75": "a487cc",
            "996B68": "8f70b9",
            "A26E69CC": "9f7ec4",
            "A06C67CC": "9979bd",
            "652420": "3b1d4d",
            "7A2C2C": "472659",
            "8F4040": "593169",
            "2A1111": "1f0f2b",
            "2C1111": "211230",
            "2A111180": "1f0f2b",
            "2A1111CC": "1f0f2bcc",
            "2C111180": "221333",
            "2C1111CC": "221333cc",
            "321212": "261234",
            "32121290": "26123490",
            "34141499": "29153b99",
            "341414B5": "29153bb5",
            "371515": "2b153c",
            "3C1616CC": "30183ccc",
            "3D1616CC": "31183dcc",
            "401818": "341b45",
            "441A1A70": "361f4b70",
            "FF7F6E": "d590ff",
            "FF9E80": "e8b4ff",
            "FFB4A2": "efc6ff",
            "FF7F6E80": "d590ff",
            "FF7F6ECC": "d590ffcc",
            "FF9E8099": "e8b4ff99",
            "FFB4A2AA": "efc6ffaa"
        }
    },
    "mesopic_moss": {
        "name": "AstigmatismEasy Mesopic Moss — Ambient Balance",
        "file": "astigmatism-easy-mesopic-moss-theme.json",
        "colors_overrides": {
            "editor.background": "#101b11",
            "editor.foreground": "#ccd8c3",
            "editorGutter.background": "#101b11cc",
            "editor.selectionBackground": "#23472d5c",
            "editor.selectionHighlightBackground": "#1c352728",
            "editor.lineHighlightBackground": "#182b1f66",
            "editor.lineHighlightBorder": "#1f3426",
            "editorCursor.foreground": "#95c674",
            "editorWidget.background": "#162319",
            "editorWidget.border": "#1d2f22",
            "editorSuggestWidget.background": "#162319",
            "editorHoverWidget.background": "#162319",
            "editorHoverWidget.statusBarBackground": "#101b11",
            "activityBar.background": "#172418",
            "activityBar.activeBackground": "#1d3220cc",
            "activityBarBadge.background": "#b9d693",
            "activityBarBadge.foreground": "#101b11",
            "sideBar.background": "#172418",
            "sideBarSectionHeader.background": "#1d2f1f",
            "list.activeSelectionBackground": "#1f3423",
            "list.inactiveSelectionBackground": "#192a1d",
            "list.hoverBackground": "#192a1d",
            "list.focusBackground": "#213624cc",
            "statusBar.background": "#101b11",
            "statusBar.noFolderBackground": "#142015",
            "statusBarItem.activeBackground": "#bfdc9dcc",
            "statusBarItem.hoverBackground": "#1d3220cc",
            "titleBar.activeBackground": "#101b11",
            "titleBar.inactiveBackground": "#101b11",
            "titleBar.border": "#152215cc",
            "tab.activeBackground": "#1b2d1f",
            "tab.inactiveBackground": "#101b11",
            "panel.background": "#142317",
            "panelSectionHeader.background": "#162319",
            "panel.border": "#1c2c1f",
            "terminal.background": "#0c150d",
            "terminal.border": "#1b2b1d",
            "terminal.foreground": "#d2e1c6",
            "quickInput.background": "#162319",
            "minimap.background": "#101b1180",
            "scrollbar.shadow": "#101b11cc",
            "badge.background": "#bcd799",
            "progressBar.background": "#bcd799"
        },
        "palette": {
            "F08C7C": "a6c978",
            "F19982": "afd487",
            "F3A086": "b7d89a",
            "F3B39E": "c6e3af",
            "E7A07D": "bad38f",
            "E08C75": "b0c87d",
            "DFA480": "c0da93",
            "E29BA8": "b8dcb1",
            "D66864": "8fb86d",
            "E67470": "99c478",
            "E26F6A": "8fba6a",
            "E27470": "96c275",
            "D89273": "aecd85",
            "D69C86": "b3d098",
            "D6655F": "86b062",
            "C78876": "8bab75",
            "C97F63": "97b470",
            "E9A8B2": "c8dfbf",
            "DAB3A0": "cfdab1",
            "F6D8CC": "e8f0e1",
            "F2D6C9": "e2ebd9",
            "C6A093": "c0d2b4",
            "C18D88": "b9c6a9",
            "C9978E": "c4d1b2",
            "DE958D": "cccaa7",
            "B17E78": "a6b69c",
            "B27D78": "a9ba9f",
            "A8746E": "9dad8c",
            "B6827A": "b5c8a6",
            "BB6B5C": "8c9c75",
            "CD7F73": "9fb087",
            "D06760": "99aa7f",
            "D7786A": "a5b58b",
            "E59374": "b6d08c",
            "A26E69": "849b73",
            "A06C67": "7f976f",
            "A87A75": "93a886",
            "996B68": "7d9070",
            "652420": "1f3523",
            "7A2C2C": "304831",
            "8F4040": "3f5a41",
            "2A1111": "16241b",
            "2C1111": "18281d",
            "321212": "203024",
            "341414": "233427",
            "371515": "273a2c",
            "3C1616": "2d4231",
            "401818": "304937",
            "441A1A": "32503a",
            "FF7F6E": "b6de8a",
            "FF9E80": "cbe9a6",
            "FFB4A2": "d7f0bb"
        }
    },
    "photopic_ember": {
        "name": "AstigmatismEasy Photopic Ember — High-Ambient Comfort",
        "file": "astigmatism-easy-photopic-ember-theme.json",
        "colors_overrides": {
            "editor.background": "#201107",
            "editor.foreground": "#f1d7bc",
            "editorGutter.background": "#201107cc",
            "editor.selectionBackground": "#4a251776",
            "editor.selectionHighlightBackground": "#371b1140",
            "editor.lineHighlightBackground": "#2a1a1166",
            "editor.lineHighlightBorder": "#3c1f15",
            "editorCursor.foreground": "#f0a760",
            "editorWidget.background": "#26150a",
            "editorWidget.border": "#331c11",
            "editorSuggestWidget.background": "#26150a",
            "editorHoverWidget.background": "#26150a",
            "editorHoverWidget.statusBarBackground": "#201107",
            "activityBar.background": "#26170b",
            "activityBar.activeBackground": "#2f1c10cc",
            "activityBarBadge.background": "#f4c085",
            "activityBarBadge.foreground": "#201107",
            "sideBar.background": "#26170b",
            "sideBarSectionHeader.background": "#2c1b0f",
            "list.activeSelectionBackground": "#341c11",
            "list.inactiveSelectionBackground": "#2b170d",
            "list.hoverBackground": "#2b170d",
            "list.focusBackground": "#362013cc",
            "statusBar.background": "#201107",
            "statusBar.noFolderBackground": "#24140b",
            "statusBarItem.activeBackground": "#f7c996cc",
            "statusBarItem.hoverBackground": "#2f1c10cc",
            "titleBar.activeBackground": "#201107",
            "titleBar.inactiveBackground": "#201107",
            "titleBar.border": "#26170bcc",
            "tab.activeBackground": "#2d1a0f",
            "tab.inactiveBackground": "#201107",
            "panel.background": "#241409",
            "panelSectionHeader.background": "#26150a",
            "panel.border": "#2d1a0f",
            "terminal.background": "#170c04",
            "terminal.border": "#2a170c",
            "terminal.foreground": "#f3ddc2",
            "quickInput.background": "#26150a",
            "minimap.background": "#20110780",
            "scrollbar.shadow": "#201107cc",
            "badge.background": "#f5c995",
            "progressBar.background": "#f5c995"
        },
        "palette": {
            "F08C7C": "f0a155",
            "F19982": "f4af63",
            "F3A086": "f6b572",
            "F3B39E": "f7c88c",
            "E7A07D": "f0b678",
            "E08C75": "eb9f62",
            "DFA480": "fabd73",
            "E29BA8": "f2c18c",
            "D66864": "e37f4b",
            "E67470": "e78b56",
            "E26F6A": "dd7d4a",
            "E27470": "e38854",
            "D89273": "e5a466",
            "D69C86": "e5af7d",
            "D6655F": "d27246",
            "C78876": "c7956f",
            "C97F63": "d09a60",
            "E9A8B2": "f5cd98",
            "DAB3A0": "eac59b",
            "F6D8CC": "fce7ce",
            "F2D6C9": "f7e1c5",
            "C6A093": "d8b89d",
            "C18D88": "d1a889",
            "C9978E": "dbb49a",
            "DE958D": "e3a78d",
            "B17E78": "c29b83",
            "B27D78": "c4a086",
            "A8746E": "b9917a",
            "B6827A": "c9ae8d",
            "BB6B5C": "cc8660",
            "CD7F73": "da966f",
            "D06760": "d07f60",
            "D7786A": "dd8f6f",
            "E59374": "eaa26f",
            "A26E69": "b17d62",
            "A06C67": "ac795f",
            "A87A75": "b48b70",
            "996B68": "a4765d",
            "652420": "472612",
            "7A2C2C": "5b301a",
            "8F4040": "6d3e23",
            "2A1111": "1e140a",
            "2C1111": "21160c",
            "321212": "28190e",
            "341414": "2b1b10",
            "371515": "2f1e12",
            "3C1616": "332114",
            "401818": "382416",
            "441A1A": "3d2819",
            "FF7F6E": "f3ad6a",
            "FF9E80": "f8c088",
            "FFB4A2": "fad2a8"
        }
    }
}


def build_variants() -> None:
    base = load_theme(BASE_THEME)
    for key, spec in VARIANTS.items():
        data = copy.deepcopy(base)
        data["name"] = spec.get("name", data.get("name"))
        if "semantic_overrides" in spec:
            data.setdefault("semanticTokenColors", {}).update(spec["semantic_overrides"])
        apply_palette(data, spec.get("palette", {}))
        colors = data.setdefault("colors", {})
        colors.update(spec.get("colors_overrides", {}))
        output_path = THEMES_DIR / spec["file"]
        save_theme(output_path, data)
        print(f"Wrote {output_path.relative_to(ROOT)}")


if __name__ == "__main__":
    build_variants()
